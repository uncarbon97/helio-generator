package ${package}.test;

import cc.uncarbon.framework.core.constant.HelioConstant;
import cc.uncarbon.framework.core.context.TenantContext;
import cc.uncarbon.framework.core.context.UserContext;
import cc.uncarbon.framework.core.context.UserContextHolder;
import cc.uncarbon.framework.core.page.PageParam;
import cc.uncarbon.framework.core.page.PageResult;
import cn.hutool.core.collection.CollUtil;
import ${package}.HelioBootApplication;
import ${package}.${moduleName}.model.request.AdminInsertOrUpdate${className}DTO;
import ${package}.${moduleName}.model.request.AdminList${className}DTO;
import ${package}.${moduleName}.model.response.${className}BO;
import ${package}.${moduleName}.service.${className}Service;
import ${package}.sys.enums.UserTypeEnum;
import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

import javax.annotation.Resource;
import java.util.ArrayList;
import java.util.List;

@Slf4j
//                      ğŸ‘‡ è¿™é‡Œéœ€è¦æ”¹æˆç›¸åº”å¯åŠ¨ç±» ğŸ‘‡
@SpringBootTest(classes = HelioBootApplication.class)
class ${className}UnitTest {

    @Resource
    private ${className}Service ${classname}Service;


    /**
     * å•å…ƒæµ‹è¯•-åˆå§‹åŒ–
     */
    @BeforeEach
    public void init() {
        // å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–æ“ä½œ, å¦‚è®¾ç½®ç”¨æˆ·ä¸Šä¸‹æ–‡ç­‰
        UserContextHolder.setUserContext(
                UserContext.builder()
                        .userId(1L)
                        .userName("admin")
                        .userType(UserTypeEnum.ADMIN_USER)
                        .relationalTenant(
                                TenantContext.builder()
                                        .tenantId(HelioConstant.CRUD.DEFAULT_TENANT_ID)
                                        .tenantName(HelioConstant.CRUD.DEFAULT_TENANT_NAME)
                                        .build()
                        )
                        .build()
        );
    }

    /**
     * å•å…ƒæµ‹è¯•-åˆ†é¡µåˆ—è¡¨
     */
    @Test
    void testAdminList() {
        PageResult<${className}BO> pageResult = ${className}Service.adminList(
                new PageParam(1, 10),
                AdminList${className}DTO.builder()

                        .build()
        );

        log.info("\n\n\nåˆ†é¡µåˆ—è¡¨æˆåŠŸ >> ç»“æœ={}", pageResult);
    }

    /**
     * å•å…ƒæµ‹è¯•-åå°æ–°å¢
     */
    @Test
    void testAdminInsert() {
        Long entityId = ${className}Service.adminInsert(
                AdminInsert${className}DTO.builder()
#foreach ($column in $columns)
#if($column.columnName != $pk.columnName
&& $column.columnName != "tenant_id"
&& $column.columnName != "revision"
&& $column.columnName != "del_flag"
&& $column.columnName != "created_at"
&& $column.columnName != "created_by"
&& $column.columnName != "updated_at"
&& $column.columnName != "updated_by"
)
                        // ${column.comments}
                        .${column.camelAttrName}(null)
#end
#end
                        .build()
        );

        log.info("\n\n\næ–°å¢æˆåŠŸ >> æ–°ä¸»é”®ID={}", entityId);
    }

    /**
     * å•å…ƒæµ‹è¯•-åå°æ›´æ–°
     */
    @Test
    void testAdminUpdate() {
        AdminInsert${className}DTO dto = AdminInsert${className}DTO.builder()
#foreach ($column in $columns)
#if($column.columnName != "tenant_id"
&& $column.columnName != "revision"
&& $column.columnName != "del_flag"
&& $column.columnName != "created_at"
&& $column.columnName != "created_by"
&& $column.columnName != "updated_at"
&& $column.columnName != "updated_by"
)
                // ${column.comments}
                .${column.camelAttrName}(null)
#end
#end
                .build();
        ${className}Service.adminUpdate(dto);

        log.info("\n\n\næ›´æ–°å®Œæˆ >> dto={}", dto);
    }

    /**
     * å•å…ƒæµ‹è¯•-åå°åˆ é™¤
     */
    @Test
    void testAdminDelete() {
        // ä¸»é”®IDåˆ—è¡¨
        ArrayList<Long> ids = CollUtil.newArrayList(1L, 2L, 3L);
        ${className}Service.adminDelete(ids);

        log.info("\n\n\nåˆ é™¤å®Œæˆ >> ids={}", ids);
    }
}
